{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Farm Dashboard</title>
    <!-- <link rel="icon" href="{% static 'favicon/favicon.ico' %}" type="image/x-icon"> -->
    <link rel="icon" href="/farm_dashboard/dashboard/static/favicon/favicon.ico" type="image/x-icon">
    <!-- Import JetBrains Mono -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    {% if show_dashboard %}
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% endif %}
    <style>
        body {
            background-color: #153b1f;   /* Dark green background */
            font-family: 'JetBrains Mono', monospace;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }

        .box {
            width: 70vw;
            height: auto; /* The constraint we must work around */
            margin: 20px auto;
            background-color: #1e4a2a;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            /* Note: If you want the video to ignore the 20px padding of the box, 
            you may need to adjust the structure slightly, but we'll assume it goes inside the padding for now. */
        }

        .picture-container {
            position: relative;
            width: 70%;
            max-width: 800px;
            height: auto;
            aspect-ratio: 16 / 10; /* consistent shape */
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            background-color: #000;
        }

        .picture-container img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ✅ shows full image without cropping */
            display: block;
            border-radius: 12px;
            background-color: #000;
        }

        .scanner-beam {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to right,
                rgba(0, 255, 0, 0) 0%,
                rgba(0, 255, 0, 0.4) 50%,
                rgba(0, 255, 0, 0) 100%
            );
            animation: scan-horizontal 3s linear infinite;
            pointer-events: none;
            mix-blend-mode: screen;
        }

        @keyframes scan-horizontal {
            0%   { left: -100%; }
            50%  { left: 100%; }
            100% { left: -100%; }
        }


        h1, h2 {
            text-align: center;
            font-weight: 400;
        }

        label {
            display: block;
            margin-top: 15px;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 14px;
            border-radius: 7px;
            background: yellow; /* slider track background */
            outline: none;
            margin-top: 5px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2e6b3f;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2e6b3f;
            cursor: pointer;
        }

        button {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            font-family: 'JetBrains Mono', monospace;
            background-color: #2e6b3f;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background-color: #3a8f50;
        }

        pre {
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h1>Farm Parameter Input</h1>

    <!-- Box 1: Sliders -->
    <div class="box">
        <form action="/predict/" method="get">
            <label>Temperature (°C):</label>
            <input type="range" name="temp" min="10" max="40" value="{{ temp|default:25 }}">

            <label>Moisture (%):</label>
            <input type="range" name="moisture" min="0" max="100" value="{{ moisture|default:50 }}">

            <label>Soil pH:</label>
            <input type="range" name="ph" min="3" max="9" step="0.1" value="{{ ph|default:6.5 }}">

            <label>Pest Infestation Level:</label>
            <input type="range" name="pest" min="0" max="100" value="{{ pest|default:0 }}">

            <button type="submit">Get Treatment Recommendation</button>
        </form>

    </div>

    <!-- Box 2: AI Recommendation -->
    <div class="box">
        <h2>Recommended Treatment:</h2>
        <pre style="white-space:pre-wrap;">{{ recommendation }}</pre>
    </div>


    <!-- Box 3: Placeholder for 3D Model 1 -->
   <div class="box picture-container">
        <!-- <img src="{% static 'images/AI Drone.png' %}" alt="Drone Image"> -->
        <img src="/dashboard/static/images/AI Drone.png" alt="Drone Image">
        <div class="scanner-beam"></div>
    </div>


    <!-- Box 4: Placeholder for 3D Model 2 -->
    <div class="dashboard-shell">
        <!-- {% include "dashboard_monitor.html" %} -->
         <!-- Subtle scan-line overlay -->
  <div class="scanlines" aria-hidden="true"></div>

  <main class="dashboard">
    <header class="dash-header">
      <h1>Digital Monitor</h1>
      <p>Live sensor telemetry</p>
    </header>

    <!-- Glowing rounded-rectangle panel shell -->
    <section class="panel-shell">
      <div class="panel-grid">
        <!-- Moisture -->
        <article class="panel">
          <div class="panel-header">
            <h2>Moisture (%)</h2>
          </div>
          <div class="panel-body">
            <div class="metric-row">
              <div class="metric-large" id="moisture-value">--</div>
            </div>
            <canvas id="moisture-spark" class="sparkline" width="400" height="80" aria-label="Moisture sparkline"></canvas>
          </div>
        </article>

        <!-- Soil pH -->
        <article class="panel">
          <div class="panel-header">
            <h2>Soil pH</h2>
          </div>
          <div class="panel-body">
            <div class="metric-row">
              <div class="metric-large" id="ph-value">--</div>
            </div>
            <div class="bars" aria-label="pH bar indicators">
              <div class="bar"><span class="bar-fill" id="ph-bar-1"></span></div>
              <div class="bar"><span class="bar-fill" id="ph-bar-2"></span></div>
              <div class="bar"><span class="bar-fill" id="ph-bar-3"></span></div>
              <div class="bar"><span class="bar-fill" id="ph-bar-4"></span></div>
              <div class="bar"><span class="bar-fill" id="ph-bar-5"></span></div>
            </div>
          </div>
        </article>

        <!-- Temperature -->
        <article class="panel">
          <div class="panel-header">
            <h2>Temperature (°C)</h2>
          </div>
          <div class="panel-body">
            <div class="metric-row">
              <div class="metric-large" id="temp-value">--</div>
            </div>
            <canvas id="temp-spark" class="sparkline" width="400" height="80" aria-label="Temperature sparkline"></canvas>
          </div>
        </article>

        <!-- NPK Requirements -->
        <article class="panel">
          <div class="panel-header">
            <h2>NPK Requirements (%)</h2>
          </div>
          <div class="panel-body">
            <div class="npk-row">
              <div class="npk-item">
                <div class="npk-label">N</div>
                <div class="metric-large" id="npk-n">--</div>
              </div>
              <div class="npk-item">
                <div class="npk-label">P</div>
                <div class="metric-large" id="npk-p">--</div>
              </div>
              <div class="npk-item">
                <div class="npk-label">K</div>
                <div class="metric-large" id="npk-k">--</div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </section>

    <footer class="dash-footer">
      <span>Status: Online • Refresh every 2s</span>
    </footer>
  </main>
  <style>
    /*
:root {
  --bg: #000000;
  --neon: #39ff14;
  --neon-soft: rgba(57, 255, 20, 0.20);
  --text: #c6ffc0;
  --panel-border: rgba(57, 255, 20, 0.35);
  --divider: rgba(57, 255, 20, 0.18);
}

*,
*::before,
*::after { box-sizing: border-box; }

html, body {
  height: 100%;
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}
*/

.dashboard-shell .scanlines {
  position: fixed;
  inset: 0;
  pointer-events: none;
  background-image: repeating-linear-gradient(
    to bottom,
    rgba(57,255,20,0.05) 0px,
    rgba(57,255,20,0.05) 2px,
    transparent 3px,
    transparent 6px
  );
  mix-blend-mode: screen;
  opacity: 0.22;
}

.dashboard-shell .dashboard {
  max-width: 1200px;
  margin: 0 auto;
  padding: clamp(16px, 3vw, 24px);
}

.dashboard-shell .dash-header { text-align: center; margin-bottom: 16px; }

.dashboard-shell .dash-header h1 {
  margin: 0;
  font-weight: 900;
  font-size: clamp(1.2rem, 2.6vw, 1.7rem);
  color: var(--neon);
  text-shadow: 0 0 12px var(--neon), 0 0 28px var(--neon);
  letter-spacing: 0.08em;
}

.dashboard-shell .dash-header p { margin: 6px 0 0; color: #9aff8a; opacity: 0.85; }

/* Glowing rounded-rectangle shell */
.dashboard-shell .panel-shell {
  border-radius: 18px;
  padding: clamp(12px, 2.5vw, 16px);
  background:
    radial-gradient(ellipse at center, rgba(57,255,20,0.14), rgba(0,0,0,0.55)),
    linear-gradient(to bottom, rgba(57,255,20,0.08), rgba(0,0,0,0.4));
  box-shadow:
    0 0 0 1px var(--panel-border) inset,
    0 0 40px var(--neon-soft),
    0 0 90px rgba(57,255,20,0.08) inset;
}

/* 2×2 grid with thin dividers */
.dashboard-shell .panel-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(260px, 1fr));
  gap: 16px;
  position: relative;
}

.dashboard-shell .panel-grid::before,
.panel-grid::after {
  content: "";
  position: absolute;
  background: var(--divider);
  filter: drop-shadow(0 0 6px rgba(57,255,20,0.35));
}

.dashboard-shell .panel-grid::before { /* vertical divider */
  top: 0; bottom: 0; left: 50%;
  width: 1px;
  transform: translateX(-8px);
}

.dashboard-shell .panel-grid::after { /* horizontal divider */
  left: 0; right: 0; top: 50%;
  height: 1px;
  transform: translateY(-8px);
}

/* Individual panels */
.dashboard-shell .panel {
  border-radius: 14px;
  background: rgba(0, 25, 0, 0.6);
  box-shadow:
    0 0 0 1px var(--panel-border) inset,
    0 0 22px rgba(57,255,20,0.18) inset,
    0 10px 22px rgba(0, 0, 0, 0.65);
  overflow: hidden;
  position: relative;
}

.dashboard-shell .panel::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, rgba(57,255,20,0.06), transparent 35%);
  pointer-events: none;
}

.dashboard-shell .panel-header {
  padding: 12px 14px;
  border-bottom: 1px solid var(--divider);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.dashboard-shell .panel-header h2 {
  margin: 0;
  font-size: 0.95rem;
  font-weight: 800;
  color: var(--neon);
  text-shadow: 0 0 8px var(--neon);
  letter-spacing: 0.06em;
}

.dashboard-shell .panel-body { padding: 12px 14px 16px; }

.dashboard-shell .metric-row {
  display: flex;
  align-items: baseline;
  column-gap: 12px;
  margin-bottom: 8px;
}

.dashboard-shell .metric-large {
  font-size: clamp(1.8rem, 4.5vw, 2.8rem);
  font-weight: 900;
  color: var(--neon);
  text-shadow: 0 0 18px var(--neon), 0 0 38px rgba(57,255,20,0.45);
  line-height: 1;
}

/* Sparkline canvas */
.dashboard-shell .sparkline {
  width: 100%;
  height: 80px;
  display: block;
  border-top: 1px dashed var(--divider);
  border-bottom: 1px dashed var(--divider);
  filter: drop-shadow(0 0 5px rgba(57,255,20,0.4));
  background: linear-gradient(to right, rgba(57,255,20,0.05), transparent 20%, transparent 80%, rgba(57,255,20,0.05));
  border-radius: 8px;
}

/* pH bars */
.dashboard-shell .bars {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  align-items: end;
  gap: 8px;
  height: 92px;
  padding: 8px 0 0 0;
  border-top: 1px dashed var(--divider);
}

.dashboard-shell .bar {
  position: relative;
  height: 100%;
  background: rgba(57,255,20,0.08);
  border: 1px solid var(--divider);
  border-radius: 6px;
  overflow: hidden;
}

.dashboard-shell .bar-fill {
  position: absolute;
  bottom: 0; left: 0;
  width: 100%;
  height: 0%;
  background: linear-gradient(
    to top,
    rgba(57,255,20,0.95),
    rgba(57,255,20,0.55) 60%,
    rgba(57,255,20,0.25)
  );
  box-shadow: 0 0 12px var(--neon);
  transition: height 700ms ease, filter 700ms ease;
}

/* NPK layout */
.dashboard-shell .npk-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
  margin-top: 6px;
}

.dashboard-shell .npk-item {
  display: grid;
  grid-template-rows: auto 1fr;
  align-items: start;
}

.dashboard-shell .npk-label {
  font-size: 0.8rem;
  font-weight: 800;
  color: #86ff74;
  opacity: 0.9;
  letter-spacing: 0.08em;
}

.dashboard-shell .dash-footer {
  margin-top: 18px;
  display: flex;
  justify-content: center;
  color: #86ff74;
  opacity: 0.9;
  font-size: 0.9rem;
}

/* Responsive */
@media (max-width: 860px) {
  .dashboard-shell .panel-grid { grid-template-columns: 1fr; }
  .dashboard-shell .panel-grid::before,
  .dashboard-shell .panel-grid::after { display: none; } /* remove divider illusion on stacked */
}

  </style>
  <!-- <script src="{% static 'js/script.js' %}"></script> -->
<script>
// Random helper
function randRange(min, max, decimals = 0) {
  const v = Math.random() * (max - min) + min;
  const f = Math.pow(10, decimals);
  return Math.round(v * f) / f;
}

// Sparkline drawing (neon glow line)
function drawSparkline(canvas, history, color = "#39ff14") {
  const ctx = canvas.getContext("2d");
  const w = canvas.width;
  const h = canvas.height;

  // clear
  ctx.clearRect(0, 0, w, h);

  // baseline
  ctx.strokeStyle = "rgba(57,255,20,0.22)";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(0, h / 2);
  ctx.lineTo(w, h / 2);
  ctx.stroke();

  if (history.length < 2) return;

  const min = Math.min(...history);
  const max = Math.max(...history);
  const range = Math.max(1e-6, max - min);

  // main line
  ctx.lineWidth = 2;
  ctx.strokeStyle = color;
  ctx.shadowColor = color;
  ctx.shadowBlur = 12;
  ctx.beginPath();

  history.forEach((val, i) => {
    const x = (i / (history.length - 1)) * w;
    const yNorm = (val - min) / range;
    const y = h - yNorm * (h - 8) - 4; // padding
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();

  // secondary glow pass
  ctx.shadowBlur = 24;
  ctx.lineWidth = 1;
  ctx.strokeStyle = "rgba(57,255,20,0.35)";
  ctx.beginPath();
  history.forEach((val, i) => {
    const x = (i / (history.length - 1)) * w;
    const yNorm = (val - min) / range;
    const y = h - yNorm * (h - 8) - 4;
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();
}

// pH bars animation: map pH (4.5–8.0) to 0–100%
function setPhBars(ph) {
  const bars = [
    document.getElementById("ph-bar-1"),
    document.getElementById("ph-bar-2"),
    document.getElementById("ph-bar-3"),
    document.getElementById("ph-bar-4"),
    document.getElementById("ph-bar-5"),
  ];

  const norm = (ph - 4.5) / (8.0 - 4.5); // 0..1
  bars.forEach((el, i) => {
    // subtle variance for visual interest
    const variance = Math.sin((norm + i * 0.18) * Math.PI) * 0.28 + 0.72;
    const height = Math.max(8, Math.min(100, Math.round(100 * norm * variance)));
    el.style.height = height + "%";
    el.style.filter = `drop-shadow(0 0 ${6 + Math.round(10 * norm)}px rgba(57,255,20,0.7))`;
  });
}

// Histories for sparklines
const moistureHistory = new Array(30).fill(50);
const tempHistory = new Array(30).fill(25);

// HiDPI scaling for crisp lines
function scaleCanvas(canvas) {
  const ratio = Math.ceil(window.devicePixelRatio || 1);
  const w = canvas.width;
  const h = canvas.height;
  canvas.width = w * ratio;
  canvas.height = h * ratio;
  canvas.style.width = w + "px";
  canvas.style.height = h + "px";
  const ctx = canvas.getContext("2d");
  ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
}

// Update loop every 2 seconds
function update() {
  // Moisture: 30–70
  const moisture = randRange(30, 70, 0);
  document.getElementById("moisture-value").textContent = moisture;
  moistureHistory.push(moisture);
  if (moistureHistory.length > 40) moistureHistory.shift();
  drawSparkline(document.getElementById("moisture-spark"), moistureHistory);

  // Soil pH: 4.5–8.0
  const ph = randRange(4.5, 8.0, 1);
  document.getElementById("ph-value").textContent = ph.toFixed(1);
  setPhBars(ph);

  // Temperature: 10–40
  const temp = randRange(10, 40, 1);
  document.getElementById("temp-value").textContent = temp.toFixed(1);
  tempHistory.push(temp);
  if (tempHistory.length > 40) tempHistory.shift();
  drawSparkline(document.getElementById("temp-spark"), tempHistory);

  // NPK: N 5–20, P 2–10, K 5–20
  const n = randRange(5, 20, 0);
  const p = randRange(2, 10, 0);
  const k = randRange(5, 20, 0);
  document.getElementById("npk-n").textContent = n;
  document.getElementById("npk-p").textContent = p;
  document.getElementById("npk-k").textContent = k;
}

window.addEventListener("DOMContentLoaded", () => {
  // scale canvases for crisp lines
  const moistureCanvas = document.getElementById("moisture-spark");
  const tempCanvas = document.getElementById("temp-spark");
  scaleCanvas(moistureCanvas);
  scaleCanvas(tempCanvas);

  // initial draw and start interval
  drawSparkline(moistureCanvas, moistureHistory);
  drawSparkline(tempCanvas, tempHistory);

  update();
  setInterval(update, 2000);
});

</script>
</div>
</body>
</html>
